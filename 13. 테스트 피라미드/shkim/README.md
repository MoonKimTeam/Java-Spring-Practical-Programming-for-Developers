# 테스트 피라미드

테스트는 목적, 범위, 대상에 따라 여러 종류로 분류될 수 있습니다.  
하지만 테스트를 분류하는 가장 일반적이고 대중적인 분류 체계는 테스트 피라미드라고 불리는 3단 분류 체계입니다.  
이 체계에서는 단위 테스트, 통합 테스트, E2E 테스트로 분류합니다.

1. 단위 테스트: 단위 테스트는 소프트웨어를 구성하는 가장 작은 단위(unit)를 검증하는 테스트를 의미합니다. 여기서 말하는 'Unit'이란 통상적으로 함수, 메서드, 클래스 같은 개별적이고 작은 코드 조각들을 지칭합니다.
2. 통합 테스트: 통합 테스트는 여러 컴포넌트나 객체가 협력하는 상황을 검증하는 테스트를 말합니다 즉, 통합 테스트는 독립적으로 만들었던 객체들이 상호작용하면서 생길 수 있는 상황을 검증합니다
3. E2E 테스트: E2E 테스트는 실제 사용자 시나리오에서 시스템이 어떻게 동작하는지를 검증하는 테스트를 말합니다. E2E 테스트는 단위 테스트나 통합 테스트에 비해 사용자의 실제 상황과 최대한 비슷한 환경에서 테스트가 이뤄집니다.

피라미드를 만들 때 가장 아래부터 만들어야 하는 것처럼, 테스트 체계를 만들기 위해서는 단위 테스트를 먼저 만들고, 이를 기반으로 통합 테스트를 만들고, 또 통합 테스트를 기반으로 E2E 테스트를 만들어야 합니다.  
우리는 테스트를 만들때 단위 테스트를 가장 먼저, 그리고 가장 많이 작성해야 합니다. 전체 테스트에서 단위 테스트가 차지하는 비율이 제일 커야 합니다. 

## 구글의 테스트 피라미드

전통적인 테스트 피라미드 모델에서 사용하는 통합 테스트나 단위 테스트 같은 용어는 모호합니다.  
다음은 구글의 테스트 피라미드 모델입니다.

<img width="413" height="281" alt="Image" src="https://github.com/user-attachments/assets/e48061fe-e8fe-4f7c-a088-526c45cfa520" />

1. 소형 테스트: 단일 서버, 단일 프로세스 단일 스레드에서 동작하며, 디스크 I/O, 블로킹 호출이 없는 테스트를 의미합니다.
2. 중형 테스트: 단일 서버에서 동작하되 멀티 프로세스 멀티 스레드를 사용할 수 있는 테스트를 의미합니다.
3. 대형 테스트: 멀티 서버에서 동작하는 테스트를 의미합니다

## 테스트 분류 기준

구굴의 테스트 분류 기준은 다음과 같습니다.

1. 테스트가 결정적(deterministic)인가 ?
2. 테스트의 속도가 빠른가 ?

구글이 생각하는 테스트를 구분 짓는 주요 특징은 두 가지입니다. 바로 테스트의 결정성과 속도입니다.  
왜냐하면 이 두 조건을 만족하는 테스트가 일반적으로 좋은 테스트라고 불리기 때문입니다.

결정적인 테스트는 버그 상황을 재현하기 쉽습니다. 왜냐하면 버그가 발생했을 때 원인이 되는 입력이 무엇인지 바로 확인할 수 있기 때문입니다.  
테스트의 주목적 중 하나는 시스템에 문제가 발생했을 때 문제가 되는 부분을 빠르게 진단할 수 있게 하기 위함입니다. 그리고 이를 위해서는 테스트가 같은 입력에 같은 결과를 보장해야 합니다.  

> 테스트는 어떨 때 비결정적으로 변하고, 어떨 때 속도가 느려지는 것일까요?  
> 
> 비결정적인 테스트가 만들어지는 이유
> 1. 테스트가 병렬 처리를 사용할 경우
> 2. 테스트가 디스크 I/O를 사용할 경우
> 3. 테스트가 다른 프로세스와 통신할 경우
> 4. 테스트가 외부 서버와 통신할 경우
> 
> 속도가 느린 테스트가 만들어지는 이유
> 1. 테스트가 블로킹 호출을 사용할 경우
> 2. 테스트가 디스크 I/O를 사용할 경우
> 3. 테스트가 다른 프로세스와 통신할 경우
> 4. 테스트가 외부 서버와 통신할 경우

## 소형 테스트의 중요성

소형 테스트를 작성하기 위해 노력하다 보면 트랜잭션 스크립트같은 코드가 나올 확률이 줄어듭니다.  
애플리케이션 서비스는 리포지터리와 통신하는 경우가 많습니다. 즉, 애플리케이션 서비스의 테스트는 중형 테스트가 될 확률이 높다는 의미입니다.  
그래서 트랜잭션 스크립트의 테스트를 소형 테스트로 작성하는 것은 어려운 일입니다. 그러니 트랜잭션 스크립트에 있는 비즈니스 로직의 테스트를 소형 테스트로 만들기 위해서는 다른 접근법이 필요합니다.  
**이를 해결하는 가장 간단한 방법은 트랜잭션 스크립트가 갖고 있던 비즈니스 로직을 도메인으로 옮기는 것입니다.**  


















