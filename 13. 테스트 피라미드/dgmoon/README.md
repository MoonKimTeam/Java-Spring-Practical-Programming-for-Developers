# ch.13 테스트 피라미드

- 테스트 피라미드: 단위 테스트 - 통합테스트 - E2E 테스트
- 단위 테스트: 소프트웨어를 구성하는 가장 작은 단위를 검증하는 테스트
    - 단위는 함수, 메서드, 클래스와 같은 개별적이고 작은 코드 조각 지칭
    - 컴포넌트에 할당된 작은 책임 하나가 예상대로 동작하는지 확인하는 테스트
- 통합 테스트: 여러 컴포넌트나 객체가 협력하는 상황을 검증하는 테스트
    - 독립적으로 만들었던 테스트들이 상호작용하면서 생길수 있는 상황을 검증
    - 통합테스트는 객체들의 협력이 제대로 이뤄지는지 평가하는 단계
    - 애플리케이션 서비스 관점에서 본다면 통합테스트는 비즈니스 프로세스의 흐름을 검사하는 테스트 역할
- E2E 테스트: 실제 사용자 시나리오에서 시트메이 어떻게 동자갛는지를 검증하는 테스트
    - 단위테스트나 통합테스트에 비해 사용자의 실제 상황과 최대한 비슷한 환경에서 테스트가 이뤄짐

- 테스트 피라미드에서 각 계층의 면적은 어떤 테스트가 더 많아야 하는지, 어떤 테스트부터 먼저 만들어야 하는지 나타냄
- 단위 테스트가 중요
- 소프트웨어 시스템은 복잡계이며, 반드시 통합테스트나 단위 테스트가 뒷받침돼야 함
- 기존 테스트 피라미드에 관한 설명은 불만족스러움
    - 각 계층에 대한 정의가 너무 모호하고 말하고 싶은게 와닿지 않음
    - 인지 모델로써 한계가 있음

## 구글의 테스트 피라미드

- 소형 테스트 - 중형 테스트 - 대형 테스트
- 여기서 테스트의 크기는 테스트를 실행하는 데 사용되는 리소스의 크기를 뜻함
- 소형 테스트: 단일 서버, 단일 프로세스, 단일 스레드에서 동작하며, 디스크 I/O, 블로킹 호출이 없는 테스트
- 중형 테스트: 단일 서버에서 동작하되 멀티 프로세스, 멀티 스레드를 사용할 수 있는 테스트
- 대형 테스트: 멀티 서버에서 동작하는 테스트

## 테스트 분류 기준

- 테스트가 결정적인가
- 테스트의 속도가 빠른가

- 구글이 생각하는 테스트는 결정적이고 빠를수록 좋음
    - 예를 들어 H2를 사용한 테스트는 비결정적으로 동작할 가능성이 있는 테스트(H2 프로세스, 프로세스간 통신 상태 등에 영향)
- 결정적인 테스트는 버그 상황을 재현하기 쉬움
    - 버그가 발생했을 때 원인이 되는 입력이 무엇인지 바로 확인 가능하기 때문
- 좋은 테스트는 빨라야 함
    - 테스트를 실행했을 때 테스트의 성공 실패 여부를 빠르게 확인할 수 있어야 함
    - 테스트 속도가 느리면 개발자들은 테스트를 실행하는데 부담을 느끼며, 그로 인해 테스트를 관리하고 싶다는 의욕도 크게 줄어듦
- 비결정적인 테스트가 만들어지는 이유
    - 테스트가 병렬처리를 사용할 경우
    - 테스트가 디스크 I/O를 사용할 경우
    - 테스트가 다른 프로세스와 통신할 경우
    - 테스트가 외부 서버와 통실할 경우
- 속도가 느린 테스트가 만들어지는 경우
    - 테스트가 블로킹 호출을 사용할 경우
    - 테스트가 디스크 I/O를 사용할 경우
    - 테스트가 다른 프로세스와 통신할 경우
    - 테스트가 외부 서버와 통신할 경우
- 소형테스트의 실질적인 목표는 테스트를 결정적이고 빠른 테스트로 만드는 것에 있다고 볼 수 있음
    - 그래서 테스트에 디스크 I/O가 있어서도 안되고 블로킹 호출이 있어서도 안 됨
- 소형 테스트는 몇 개가 있든 모든 텥스틀 완전히 병렬로 실행 가능 -> 속도 엄청 빨라질 수 있음
- 그러나 모든 테스트를 소형 테스트로 만들 수는 없음

## 소형 테스트의 중요성

- 기억해둘 만한 인사이트

1. 시스템에는 소형 테스트가 많아야 합니다.
2. 중형 테스트나 대형 테스트가 소형 테스트보다 많아지는 것은 바람직하지 않은 현상입니다.
3. 소형 테스트는 단일 스레드. 단일 프로세스 단일 서버에서 실행되며, 디스크 I/O, 블로킹 호출이 없는 테스트입니다.
4. H2를 이용한 테스트는 중형 테스트입니다.