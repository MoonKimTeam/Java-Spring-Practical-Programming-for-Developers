# ch.15 테스트 가능성

- 테스트를 이용하면 전체 시스템 품질 향상
- 테스트를 개발 완료 후가 아닌 개발하면서 작성하는 것으로 보기
- 테스트를 사용하는 목적: 회귀 버그 방지, 좋은 설계를 얻기 위함
- 테스트를 좋은 설계를 시스템을 얻기 위한 도구로 보면 테스트가 주는 가치 누릴 수 있게됨 -> testability

## 테스트를 어렵게 만드는 요소

- testability: 테스트 용이성
- 테스트는 테스트를 하려는 대상의 입력을 쉽게 변경할 수 있고, 출력으 쉽게 변경할 수 있을 때 작성하기 쉬움

### 숨겨진 입력

- 코드에 가급적 숨겨진 입력을 만들지 않는 것이 좋음
    - 책의 예시에서 login 메서드에 epochmillis를 인수로 받기 등
    - -> 테스트를 할 때 변하는 값이 있으면 인수로 넣도록 설계를 변경하자
- 테스트를 쉽게 하는 법을 고민하니 숨겨진 원칙을 제거하라는 설계 원칙을 자연스럽게 따르게 됨
- 의존성 주입과 의존성 역전을 동시에 사용하기
    - 책의 예시에서 익명클래스 만들어서 stub 생성도 가능
    - 똑같은 기능을 하면서도 유연한 변경이 가능해짐
    - 선택적으로 컴포넌트를 사용할 수 있음
- "테스트하기 쉬운 코드는 좋은 설계일 확률이 높다"라는 명제 기억하기

### 숨겨진 출력

- 개발자는 입력, 출력, 시그니처만 가지고 메서드의 동작과 호출 결과가 어떨지 추론해야 하므로 메서드 호출 출력 결과가 반환 값으로 드러나는 것이 좋음
    - 책의 예시에서 sysout과 같이 호출 결과가 반환 값이 아닌 경우
        - 시스템 출력 스트림(System.out)을 임시로 변경해서 테스트 할 수는 있음
        - 좀 더 간단한 해결책은 반환값을 이용하는 것
        - 다른 해결책은 반환값을 위한 DTO를 만드는 것
- 숨겨진 입출력은 부수효과
    - 부수효과가 있으면 비순수함수
    - 함수형 프로그래밍에서는 부수효과를 최대한 줄이는 방향으로 프로그래밍

## 테스트가 보내는 신호

- 테스트의 입출력을 확인할 수 없다면 입출력을 확인할 수 있는 구조로 변경한다.
    - 랜덤이나 숨겨집 입력은 외부로 드러내기
    - 숨겨진 출력이 존재하면 반환값을 이용해서 출력되도록 변경하기
- private 메서드는 테스트할 필요가 없음(인터페이스만 테스트해도 충분)
    - private 메서드를 테스트하고 싶다면 책임을 잘못 할당한 것
- 서비스 컴포넌트 간단한 메서드 테스트 하고 싶을 뿐인데 객체 너무 많이 주입한다면 서비스 컴포넌트를 더 작게 나누라는 의미
- 메서드 코드 커버리지를 100% 달성하는 것을 목표로 삼지 말 것
    - 긴코드로 인해 테스트 케이스가 너무 많아진다면 해당 메서드에 책임이 너무 많이 할당된 것은 아닌지 고민해볼 것
- Mockito, H2 없이도 테스트 할 수 있어야 한다
- 어떻게 해야 테스트가 쉬워질지 고민하는 것이 더 중요