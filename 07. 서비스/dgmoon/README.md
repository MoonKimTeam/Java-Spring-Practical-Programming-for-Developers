# ch.07 서비스

## Manager

- @Service는 DDD 에서 영감을 받아 만들어진 애너테이션
- 도메인 주도 설계
    - 도메인: 비즈니스 영역이자 우리가 해결하고 싶은 문제 영역
- DDD 세상의 개발자에게는 도메인 자체를 사전에 아는 것이 아닌, 도메인을 분석하고 탐색할 수 있는 능력이 요구됨
    - 도메인 탐색 과정은 '도메인 전문가'라는 집단과 소통하면서 이뤄짐(도메인 전문가와 협력이 강조됨)
- 서비스는 도메인 객체가 처리하기 애매한 연산 자체를 표현하기 위한 컴포넌트
- 가격과 같이 도메인 객체가 처리하기 애매한 경우 새로운 클래스를 만들고 그쪽으로 밀어 넣기
    - 애플리케이션에 꼭 필요하지만 연산 그 자체로는 어떠한 객체도 "갖고 있기 애매해서" 만들어지는 별도의 클래스가 서비스(매니저)
- 많은 개발자들이 비즈니스 로직이라는 이름하에 서비스 컴포넌트에 모든 코드를 작성하지만, 대부분 도메인 객체가 처리해야하는 경우가 많음
- 스프링 서비스는 도메인, 도메인 서비스의 파사드 처럼 사용할 수 있는 공간
    - 왜냐하면 비즈니스 로직을 갖기 있는 곳이 도메인과 도메인 서비스이기 때문
- 다음의 질문에 답해보기
    - 서비스란 뭘까요?
    - 서비스는 왜 서비스라고 부를까요?

## 서비스보다 도메인 모델

- 새로운 도메인 모델 만들면 비즈니스 연산 로직도 도메인 객체로 옮길 수 있음
    - PriceManager는 가격과 관련된 연산 로직을 갖고 있을 것 같고, Cashier은 점원의 역할을 수행하며 능동적으로 일할 것 같음
    - 따라서, PriceManager는 유의미한 도메인 객체로서 확장되기 어려움
    - 도메인과 도메인 서비스는 이름으로 결정되는 것이 아니라 행동으로 결정됨
- 객체지향으로 보는 서비스
    - 서비스는 가능한 적게 만들고, 얇게 유지해야 함
    - 서비스보다 풍부한 도메인 모델을 만들어야 함
- 우리가 겪는 대부분의 비즈니스 로직은 사실 도메인 객체로 표현할 수 있음
- 도메인 모델 > 도메인서비스 > 애플리케이션 서비스 순으로 우선순위를 두기
    - 이렇게 하면 의존성이 명확하게 드러나 테스트 작성도 용이해짐

## 작은 기계

- 서비스는 불변해야 함
- 객체로 표현하기 애매한 연산 로직의 집합이기 때문에, 객체가 아니라 계산식 그 자체이며, 그러므로 불변이어야 함
    - 생성자 주입하는 근본적인 이유도 서비스는 불변해야 하기 때문

## 조언

- 서비스와 관련된 행동 조언

1. 서비스의 멤버 변수는 모두 final로 만드세요
2. 서비스에 세터가 존재한다면 지우세요
3. 서비스는 반드시 생성자 주입으로 바꾸세요
4. 서비스의 비즈니스 로직을 도메인에 양보하세요
5. 서비스를 얇게 유지하세요